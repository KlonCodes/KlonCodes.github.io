<!DOCTYPE html>
<html lang="en">
<!--
    Simple Ebook reader in AR for H-BRS Advanced User Interfaces
    by
    Colin Brett
    June 2023
-->

<head>
    <!--  Imports:
        - aFrame for AR
        - jQuery for ebook managment and animations -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/magicleap-controls"></script>

    <!--  Books:
        - Script to import books as .book  -->
    <script>
        $(function () {
            //$(".book").load("/FrankHTML.html"); // Frankenstein
            $(".book").load("/KafkaHTML.html"); // Metamorphasis  
            //$(".book").load("/DorianHTML.html"); // A Picture of Dorian Gray
            //$(".book").load("/BorderHTML.html"); // Borderland
        });
    </script>

    <!--  Animations:
        - Scolling on keypress
        - Will add MAGICLEAP controller swipes  -->
    <script>

        $(document).ready(function () {
            var smallScrollAmount = 1; // Number of lines to scroll for small movements
            var bigScrollAmount = 3; // Number of lines to scroll for big jumps
            var lineHeight = 20; // Height of each line in pixels
            var animationDuration = 800; // Duration of the animation in milliseconds (for small movements)

            // Listen for Magic Leap controller swipes
            MLControls.onSwipe(function (swipeDirection) {
                if (swipeDirection === 'up') {
                    var currentPosition = $('.book').scrollTop();
                    var newPosition = Math.max(currentPosition - smallScrollAmount * lineHeight, 0); // Restrict scrolling above the top of the page
                    $('.book').scrollTop(newPosition);
                } else if (swipeDirection === 'down') {
                    var currentPosition = $('.book').scrollTop();
                    var maxScroll = $('.book')[0].scrollHeight - $('.book').height();
                    var newPosition = Math.min(currentPosition + smallScrollAmount * lineHeight, maxScroll); // Restrict scrolling below the top of the page
                    $('.book').scrollTop(newPosition);
                } else if (swipeDirection === 'left') {
                    var currentPosition = $('.book').scrollTop();
                    var newPosition = currentPosition - $('.book').height() + bigScrollAmount * lineHeight;
                    $('.book').animate({ scrollTop: newPosition }, animationDuration); // smooth scroll for big moves
                } else if (swipeDirection === 'right') {
                    var currentPosition = $('.book').scrollTop();
                    var maxScroll = $('.book')[0].scrollHeight - $('.book').height();
                    var newPosition = Math.min(currentPosition + $('.book').height() - bigScrollAmount * lineHeight, maxScroll);
                    $('.book').animate({ scrollTop: newPosition }, animationDuration);
                }

                var totalHeight = $('.book')[0].scrollHeight - $('.book').height();
                var scrollPercentage = (newPosition / totalHeight) * 100;
                var perc = Math.max(0.00, scrollPercentage).toFixed(2);
                document.getElementById('disp').innerHTML = perc;
            });
        });

    </script>
</head>

<style>
    /* @import url('https://fonts.googleapis.com/css2?family=Bacasime+Antique&display=swap'); */

    #Window {
        /* AFrame Scene */
        height: 100%;
        display: flex;
        overflow: hidden;
    }

    #Canvas {
        /* Book Window */
        width: 80%;
        height: 80%;
        position: absolute;
        top: 50%;
        left: 50%;
        -webkit-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        background-color: blanchedalmond;
        display: flex;
        overflow: auto;
    }

    .book {
        /* Book Content */
        margin: 1em;
        overflow-y: scroll;
        -ms-overflow-style: none;
        scrollbar-width: none;
        /*  font-family: 'Bacasime Antique', serif; */
        font-size: x-large;

        .chapter p {
            line-height: 1em;
            margin-bottom: 1em;
            /* between paragraphs */
        }
    }

    .book::-webkit-scrollbar {
        display: none;
    }


    .status {
        position: fixed;
        left: 50%;
        bottom: -10px;
        transform: translate(-50%, -50%);
        margin: 0 auto;
    }
</style>
</head>

<body>
    
    <a-scene id="Window">
        <a-plane id="Canvas">
            <div class="book"></div>
        </a-plane>
        <div class="status">
            <h3>Complete: <span id="disp">0.00</span>%</h3>
            <a-entity magicleap-controls></a-entity>
        </div>
    </a-scene>

</body>